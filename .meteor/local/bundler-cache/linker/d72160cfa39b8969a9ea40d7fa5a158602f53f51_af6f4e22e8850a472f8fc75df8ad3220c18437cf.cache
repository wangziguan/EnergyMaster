[{"type":"js","data":"/* Imports for global scope */\n\nMongoInternals = Package.mongo.MongoInternals;\nMongo = Package.mongo.Mongo;\nReactiveVar = Package['reactive-var'].ReactiveVar;\nTracker = Package.tracker.Tracker;\nDeps = Package.tracker.Deps;\nECMAScript = Package.ecmascript.ECMAScript;\nmqtt = Package['perak:mqtt-collection'].mqtt;\nValidatedMethod = Package['mdg:validated-method'].ValidatedMethod;\ncheck = Package.check.check;\nMatch = Package.check.Match;\nRouter = Package['iron:router'].Router;\nRouteController = Package['iron:router'].RouteController;\nAccounts = Package['accounts-base'].Accounts;\nRoles = Package['alanning:roles'].Roles;\nMousetrap = Package['mousetrap:mousetrap'].Mousetrap;\nAdminDashboard = Package['wangziguan:admin'].AdminDashboard;\n_ = Package.underscore._;\nCollection2 = Package['aldeed:collection2-core'].Collection2;\nMeteor = Package.meteor.Meteor;\nglobal = Package.meteor.global;\nmeteorEnv = Package.meteor.meteorEnv;\nWebApp = Package.webapp.WebApp;\nWebAppInternals = Package.webapp.WebAppInternals;\nmain = Package.webapp.main;\nDDP = Package['ddp-client'].DDP;\nDDPServer = Package['ddp-server'].DDPServer;\nLaunchScreen = Package['launch-screen'].LaunchScreen;\nBlaze = Package.ui.Blaze;\nUI = Package.ui.UI;\nHandlebars = Package.ui.Handlebars;\nSpacebars = Package.spacebars.Spacebars;\nmeteorInstall = Package.modules.meteorInstall;\nmeteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nPromise = Package.promise.Promise;\nIron = Package['iron:core'].Iron;\nSimpleSchema = Package['aldeed:simple-schema'].SimpleSchema;\nMongoObject = Package['aldeed:simple-schema'].MongoObject;\nAutoupdate = Package.autoupdate.Autoupdate;\nHTML = Package.htmljs.HTML;\n\n","servePath":"/global-imports.js"},{"type":"js","data":"var require = meteorInstall({\"imports\":{\"lib\":{\"_settings.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/lib/_settings.js                                               //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\nif (typeof Meteor.settings === 'undefined') {\n  Meteor.settings = {};\n}\n\n_.defaults(Meteor.settings, {\n  mqttTopic: \"ADE7953/#\",\n  // mqttURL: \"http://47.106.72.131:1883\",\n  mqttURL: \"http://58.196.128.13:1883\",\n  elasticSearchURL: \"http://47.106.72.131:9200\",\n  AppURL: \"http://47.106.72.131:3000/\"\n});\n////////////////////////////////////////////////////////////////////////////\n\n},\"collections.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/lib/collections.js                                             //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nSchemas = {};\nDeviceList = new Mongo.Collection(\"deviceList\");\n/**\n{\n    _id:\n    \"clientId\": \"1\",\n    \"location\": \"上海交通大学电信裙楼4-325\",\n    \"imei\": \"012345678901234\",\n    \"createAt\": new Date(),\n}\n*/\n\nMqttMessages = new Mongo.Collection(\"mqtt_messages\");\n/**\n{\n    _id:\n    \"topic\": \"ADE7953/012345678901234/out\",   \n    \"payload\": \"01010203040102030401020304010203040102030401020102fe\",\n    \"payload\": \"02010203040102030401020304fe\",\n    \"payload\": \"03(010203)x280...fe\",\n    \"createAt\": new Date(),\n}\n*/\n\nGeneralMessages = new Mongo.Collection(\"general_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"voltage\": \"220.05\",\n    \"current\": \"1.05\",\n    \"watt\": \"220.05\",\n    \"var\": \"1.05\",\n    \"va\": \"223.10\",\n    \"f\": \"50.02\",\n    \"period\": \"19.98\",\n    \"createAt\": new Date(),\n}\n*/\n\nEnergyMessages = new Mongo.Collection(\"energy_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"aenergy\": \"100.59\",\n    \"renergy\": \"10.32\",\n    \"apenergy\": \"110.03\",\n    \"createAt\": new Date(),\n}\n*/\n\nWavesampleMessages = new Mongo.Collection(\"wavesample_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"samples\": [1.00, 1.01, ..., 1.03], // 280\n    \"createAt\": new Date(),\n}\n*/\n////////////////////////////////////////////////////////////////////////////\n\n},\"email.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/lib/email.js                                                   //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n\n}, 0);\nAccounts.emailTemplates.siteName = \"EnergyMaster\";\nAccounts.emailTemplates.from = '490842289@qq.com';\n////////////////////////////////////////////////////////////////////////////\n\n}},\"api\":{\"mqtts\":{\"connect.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/api/mqtts/connect.js                                           //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nmodule.export({\n  connect: () => connect\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet ValidatedMethod;\nmodule.link(\"meteor/mdg:validated-method\", {\n  ValidatedMethod(v) {\n    ValidatedMethod = v;\n  }\n\n}, 1);\nlet SimpleSchema;\nmodule.link(\"simpl-schema\", {\n  default(v) {\n    SimpleSchema = v;\n  }\n\n}, 2);\nconst connect = new ValidatedMethod({\n  name: 'mqtts.connect',\n  validate: new SimpleSchema({\n    topic: String\n  }).validator(),\n\n  run({\n    topic\n  }) {\n    this.unblock();\n    MqttMessages.mqttConnect(Meteor.settings.mqttURL, topic, {\n      insert: true,\n      raw: false\n    });\n  }\n\n});\n////////////////////////////////////////////////////////////////////////////\n\n}},\"publish\":{\"publish.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/api/publish/publish.js                                         //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nMeteor.publish(\"deviceList\", function () {\n  return DeviceList.find();\n});\nMeteor.publish(\"currentDeviceList\", function (uid, search, limit, skip) {\n  var select = {};\n\n  if (search) {}\n\n  return DeviceList.find(select, {\n    limit: limit,\n    skip: skip\n  });\n});\nMeteor.publish(\"mqtt_messages\", function () {\n  return MqttMessages.find();\n});\nMeteor.publish(\"general_messages\", function () {\n  return GeneralMessages.find();\n});\nMeteor.publish(\"energy_messages\", function () {\n  return EnergyMessages.find();\n});\nMeteor.publish(\"wavesample_messages\", function () {\n  return WavesampleMessages.find();\n});\n////////////////////////////////////////////////////////////////////////////\n\n}}},\"startup\":{\"both\":{\"index.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/startup/both/index.js                                          //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nmodule.link(\"../../lib/_settings.js\");\nmodule.link(\"../../lib/collections.js\");\n////////////////////////////////////////////////////////////////////////////\n\n}},\"server\":{\"admin.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/startup/server/admin.js                                        //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n\n}, 0);\nlet Roles;\nmodule.link(\"meteor/alanning:roles\", {\n  Roles(v) {\n    Roles = v;\n  }\n\n}, 1);\n\nif (!Meteor.users.findOne({\n  username: 'admin'\n})) {\n  var uid = Accounts.createUser({\n    username: 'admin',\n    email: '490842289@qq.com',\n    password: 'public'\n  });\n  Roles.addUsersToRoles(uid, ['admin'], Roles.GLOBAL_GROUP);\n}\n////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/startup/server/index.js                                        //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nmodule.link(\"../../lib/email.js\");\nmodule.link(\"../../api/publish/publish.js\");\nmodule.link(\"./mqtt-parse.js\");\nmodule.link(\"./admin.js\");\nmodule.link(\"./routers.js\");\n////////////////////////////////////////////////////////////////////////////\n\n},\"mqtt-parse.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/startup/server/mqtt-parse.js                                   //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet connect;\nmodule.link(\"../../api/mqtts/connect.js\", {\n  connect(v) {\n    connect = v;\n  }\n\n}, 1);\nMeteor.startup(() => {\n  // code to run on server at startup\n  connect.call({\n    topic: Meteor.settings.mqttTopic\n  });\n});\n////////////////////////////////////////////////////////////////////////////\n\n},\"routers.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// imports/startup/server/routers.js                                      //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nlet Router;\nmodule.link(\"meteor/iron:router\", {\n  Router(v) {\n    Router = v;\n  }\n\n}, 0);\n\nvar fs = Npm.require('fs');\n\nRouter.route('/update', function () {\n  var req = this.request;\n  var res = this.response; // var filePath = '/home/wzg/wzg/meteor/EnergyMaster/public/ADE7953_1.0.0_Luat_V0027_8955.bin';\n\n  var filePath = 'ADE7953_1.0.0_Luat_V0027_8955.bin';\n  var buf = Assets.getText(filePath);\n  res.writeHeader(200, {\n    \"Content-Type\": \"application/octet-stream\",\n    'Content-Disposition': 'inline' // 'Content-Size': fileSize\n\n  });\n  res.write(buf);\n  res.end();\n}, {\n  where: 'server'\n});\n////////////////////////////////////////////////////////////////////////////\n\n}}}},\"server\":{\"main.js\":function(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////\n//                                                                        //\n// server/main.js                                                         //\n//                                                                        //\n////////////////////////////////////////////////////////////////////////////\n                                                                          //\nmodule.link(\"/imports/startup/server\");\nmodule.link(\"/imports/startup/both\");\n////////////////////////////////////////////////////////////////////////////\n\n}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nrequire(\"/server/main.js\");","servePath":"/app.js","sourceMap":{"version":3,"sources":["imports/lib/_settings.js","imports/lib/collections.js","imports/lib/email.js","imports/api/mqtts/connect.js","imports/api/publish/publish.js","imports/startup/both/index.js","imports/startup/server/admin.js","imports/startup/server/index.js","imports/startup/server/mqtt-parse.js","imports/startup/server/routers.js","server/main.js"],"names":["Meteor","module","link","v","settings","_","defaults","mqttTopic","mqttURL","elasticSearchURL","AppURL","Mongo","Schemas","DeviceList","Collection","MqttMessages","GeneralMessages","EnergyMessages","WavesampleMessages","Accounts","emailTemplates","siteName","from","export","connect","ValidatedMethod","SimpleSchema","default","name","validate","topic","String","validator","run","unblock","mqttConnect","insert","raw","publish","find","uid","search","limit","skip","select","Roles","users","findOne","username","createUser","email","password","addUsersToRoles","GLOBAL_GROUP","startup","call","Router","fs","Npm","require","route","req","request","res","response","filePath","buf","Assets","getText","writeHeader","write","end","where"],"mappings":"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","file":"/app.js","sourcesContent":["// Meteor.settings默认设置\nimport { Meteor } from 'meteor/meteor';\n\nif (typeof Meteor.settings === 'undefined'){\n  Meteor.settings = {};\n}\n\n_.defaults(Meteor.settings, {\n  mqttTopic: \"ADE7953/#\",\n  // mqttURL: \"http://47.106.72.131:1883\",\n  mqttURL: \"http://58.196.128.13:1883\",\n  elasticSearchURL: \"http://47.106.72.131:9200\",\n  AppURL: \"http://47.106.72.131:3000/\",\n})","import { Mongo } from 'meteor/mongo';\n\nSchemas = {};\n\nDeviceList = new Mongo.Collection(\"deviceList\");\n/**\n{\n    _id:\n    \"clientId\": \"1\",\n    \"location\": \"上海交通大学电信裙楼4-325\",\n    \"imei\": \"012345678901234\",\n    \"createAt\": new Date(),\n}\n*/\n\nMqttMessages = new Mongo.Collection(\"mqtt_messages\");\n/**\n{\n    _id:\n    \"topic\": \"ADE7953/012345678901234/out\",   \n    \"payload\": \"01010203040102030401020304010203040102030401020102fe\",\n    \"payload\": \"02010203040102030401020304fe\",\n    \"payload\": \"03(010203)x280...fe\",\n    \"createAt\": new Date(),\n}\n*/\n\nGeneralMessages = new Mongo.Collection(\"general_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"voltage\": \"220.05\",\n    \"current\": \"1.05\",\n    \"watt\": \"220.05\",\n    \"var\": \"1.05\",\n    \"va\": \"223.10\",\n    \"f\": \"50.02\",\n    \"period\": \"19.98\",\n    \"createAt\": new Date(),\n}\n*/\n\nEnergyMessages = new Mongo.Collection(\"energy_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"aenergy\": \"100.59\",\n    \"renergy\": \"10.32\",\n    \"apenergy\": \"110.03\",\n    \"createAt\": new Date(),\n}\n*/\n\nWavesampleMessages = new Mongo.Collection(\"wavesample_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"samples\": [1.00, 1.01, ..., 1.03], // 280\n    \"createAt\": new Date(),\n}\n*/","// 设置邮件发送信息\nimport { Accounts } from 'meteor/accounts-base';\n\nAccounts.emailTemplates.siteName = \"EnergyMaster\";\nAccounts.emailTemplates.from = '490842289@qq.com';","import { Meteor } from 'meteor/meteor';\nimport { ValidatedMethod } from 'meteor/mdg:validated-method';\nimport SimpleSchema from 'simpl-schema';\n\nexport const connect = new ValidatedMethod({\n    name: 'mqtts.connect',\n    validate: new SimpleSchema({\n        topic: String,\n    }).validator(),\n\n    run({ topic }) {\n        this.unblock();\n        MqttMessages.mqttConnect(Meteor.settings.mqttURL, topic, {\n            insert: true,\n            raw: false\n        })\n    },\n})\n","import { Meteor } from 'meteor/meteor';\n\nMeteor.publish(\"deviceList\", function () {\n    return DeviceList.find();\n});\n\nMeteor.publish(\"currentDeviceList\", function (uid, search, limit, skip) {\n    var select = {};\n    if (search) {\n    }\n    return DeviceList.find(select, {limit: limit, skip: skip});\n});\n\nMeteor.publish(\"mqtt_messages\", function () {\n    return MqttMessages.find();\n});\n\nMeteor.publish(\"general_messages\", function () {\n    return GeneralMessages.find();\n});\n\nMeteor.publish(\"energy_messages\", function () {\n    return EnergyMessages.find();\n});\n\nMeteor.publish(\"wavesample_messages\", function () {\n    return WavesampleMessages.find();\n});","import '../../lib/_settings.js';\nimport '../../lib/collections.js';\n","import { Accounts } from 'meteor/accounts-base';\nimport { Roles } from 'meteor/alanning:roles';\n\nif (!Meteor.users.findOne({username: 'admin'})) {\n  var uid = Accounts.createUser({\n      username: 'admin',\n      email: '490842289@qq.com',\n      password: 'public'\n  });\n  Roles.addUsersToRoles(uid, ['admin'], Roles.GLOBAL_GROUP);\n}\n","import '../../lib/email.js';\nimport '../../api/publish/publish.js';\n\nimport './mqtt-parse.js';\nimport './admin.js';\n\nimport './routers.js';","import { Meteor } from 'meteor/meteor';\n\nimport { connect } from '../../api/mqtts/connect.js';\n\nMeteor.startup(() => {\n    // code to run on server at startup\n    connect.call({topic: Meteor.settings.mqttTopic});\n});","import { Router } from 'meteor/iron:router';\nvar fs = Npm.require('fs');\n\nRouter.route('/update', function(){\n    var req = this.request;\n    var res = this.response;\n\n    // var filePath = '/home/wzg/wzg/meteor/EnergyMaster/public/ADE7953_1.0.0_Luat_V0027_8955.bin';\n    var filePath = 'ADE7953_1.0.0_Luat_V0027_8955.bin';\n    var buf = Assets.getText(filePath)\n\n    res.writeHeader(200,{\n        \"Content-Type\":\"application/octet-stream\",\n        'Content-Disposition': 'inline',\n        // 'Content-Size': fileSize\n    });\n    res.write(buf);\n    res.end()\n    },{where:'server'});","import '/imports/startup/server';\nimport '/imports/startup/both';\n"]}}]