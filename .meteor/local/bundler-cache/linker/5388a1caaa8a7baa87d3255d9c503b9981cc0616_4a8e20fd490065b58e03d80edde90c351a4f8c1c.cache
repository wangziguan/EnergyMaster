[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar _ = Package.underscore._;\nvar MongoInternals = Package.mongo.MongoInternals;\nvar Mongo = Package.mongo.Mongo;\nvar Blaze = Package.blaze.Blaze;\nvar UI = Package.blaze.UI;\nvar Handlebars = Package.blaze.Handlebars;\nvar HTML = Package.htmljs.HTML;\n\n/* Package-scope variables */\nvar Tabular, tablesByName;\n\n(function(){\n\n///////////////////////////////////////////////////////////////////////////////////\n//                                                                               //\n// packages/aldeed_tabular/packages/aldeed_tabular.js                            //\n//                                                                               //\n///////////////////////////////////////////////////////////////////////////////////\n                                                                                 //\n(function () {\n\n/////////////////////////////////////////////////////////////////////////////\n//                                                                         //\n// packages/aldeed:tabular/common.js                                       //\n//                                                                         //\n/////////////////////////////////////////////////////////////////////////////\n                                                                           //\nTabular = {}; //exported                                                   // 1\n                                                                           // 2\ntablesByName = {};                                                         // 3\n                                                                           // 4\nTabular.Table = function (options) {                                       // 5\n  var self = this;                                                         // 6\n                                                                           // 7\n    if (!options) {                                                        // 8\n        throw new Error(\"Tabular.Table options argument is required\");     // 9\n    }                                                                      // 10\n                                                                           // 11\n    if (!options.name) {                                                   // 12\n        throw new Error(\"Tabular.Table options must specify name\");        // 13\n    }                                                                      // 14\n    self.name = options.name;                                              // 15\n                                                                           // 16\n    if (!(options.collection instanceof Mongo.Collection)) {               // 17\n        throw new Error(\"Tabular.Table options must specify collection\");  // 18\n    }                                                                      // 19\n    self.collection = options.collection;                                  // 20\n                                                                           // 21\n    self.pub = options.pub || \"tabular_genericPub\";                        // 22\n                                                                           // 23\n    if (!options.columns) {                                                // 24\n        throw new Error(\"Tabular.Table options must specify columns\");     // 25\n    }                                                                      // 26\n                                                                           // 27\n    self.options = _.omit(options, \"collection\", \"pub\", \"name\");           // 28\n                                                                           // 29\n    tablesByName[self.name] = self;                                        // 30\n};                                                                         // 31\n/////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n/////////////////////////////////////////////////////////////////////////////\n//                                                                         //\n// packages/aldeed:tabular/server/tabular.js                               //\n//                                                                         //\n/////////////////////////////////////////////////////////////////////////////\n                                                                           //\nMeteor.publish(\"tabular_genericPub\", function (tableName, ids, fields) {   // 1\n    check(tableName, String);                                              // 2\n    check(ids, [String]);                                                  // 3\n    check(fields, Match.Optional(Object));                                 // 4\n                                                                           // 5\n    var table = tablesByName[tableName];                                   // 6\n    if (!table) {                                                          // 7\n        this.ready();                                                      // 8\n        return;                                                            // 9\n    }                                                                      // 10\n                                                                           // 11\n    //check security function                                              // 12\n    if (table.allow && !table.allow(this.userId, fields)) {                // 13\n        this.ready();                                                      // 14\n        return;                                                            // 15\n    }                                                                      // 16\n                                                                           // 17\n    return table.collection.find({_id: {$in: ids}}, {fields: fields});     // 18\n});                                                                        // 19\n                                                                           // 20\nMeteor.methods({                                                           // 21\n    \"tabular_getInfo\": function (tableName, selector, sort, skip, limit) { // 22\n        var table = tablesByName[tableName];                               // 23\n        if (!table) {                                                      // 24\n            return;                                                        // 25\n        }                                                                  // 26\n                                                                           // 27\n        this.unblock();                                                    // 28\n                                                                           // 29\n        //check security function                                          // 30\n        if (table.allow && !table.allow(this.userId, selector)) {          // 31\n            return;                                                        // 32\n        }                                                                  // 33\n                                                                           // 34\n        var filtered = table.collection.find(selector || {}, {             // 35\n            sort: sort,                                                    // 36\n            skip: skip,                                                    // 37\n            limit: limit                                                   // 38\n        });                                                                // 39\n                                                                           // 40\n        var recordsFiltered = filtered.count();                            // 41\n                                                                           // 42\n        filtered = filtered.map(function (doc) {                           // 43\n            return doc._id;                                                // 44\n        });                                                                // 45\n                                                                           // 46\n        return {                                                           // 47\n            ids: filtered,                                                 // 48\n            recordsTotal: recordsFiltered,                                 // 49\n            recordsFiltered: recordsFiltered                               // 50\n        };                                                                 // 51\n    }                                                                      // 52\n});                                                                        // 53\n/////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n///////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nPackage._define(\"aldeed:tabular\", {\n  Tabular: Tabular\n});\n\n})();\n","servePath":"/packages/aldeed_tabular.js"}]