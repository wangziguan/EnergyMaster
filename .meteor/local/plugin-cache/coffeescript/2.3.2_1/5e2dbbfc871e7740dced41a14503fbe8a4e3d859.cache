{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nthis.AdminController = RouteController.extend({\n  layoutTemplate: 'AdminLayout',\n  waitOn: function () {\n    return [Meteor.subscribe('adminUsers'), Meteor.subscribe('adminUser'), Meteor.subscribe('adminCollectionsCount')];\n  },\n  onBeforeAction: function () {\n    Session.set('adminSuccess', null);\n    Session.set('adminError', null);\n    Session.set('admin_title', '');\n    Session.set('admin_subtitle', '');\n    Session.set('admin_collection_page', null);\n    Session.set('admin_collection_name', null);\n    Session.set('admin_id', null);\n    Session.set('admin_doc', null);\n\n    if (!Roles.userIsInRole(Meteor.userId(), ['admin'])) {\n      Meteor.call('adminCheckAdmin');\n\n      if (typeof (typeof AdminConfig !== \"undefined\" && AdminConfig !== null ? AdminConfig.nonAdminRedirectRoute : void 0) === 'string') {\n        Router.go(AdminConfig.nonAdminRedirectRoute);\n      }\n    }\n\n    return this.next();\n  }\n});\nRouter.route(\"adminDashboard\", {\n  path: \"/admin\",\n  template: \"AdminDashboard\",\n  controller: \"AdminController\",\n  action: function () {\n    return this.render();\n  },\n  onAfterAction: function () {\n    Session.set('admin_title', '总览');\n    Session.set('admin_collection_name', '');\n    return Session.set('admin_collection_page', '');\n  }\n});\nRouter.route(\"adminDashboardUsersView\", {\n  path: \"/admin/Users\",\n  template: \"AdminDashboardView\",\n  controller: \"AdminController\",\n  action: function () {\n    return this.render();\n  },\n  data: function () {\n    return {\n      admin_table: AdminTables.Users\n    };\n  },\n  onAfterAction: function () {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\nRouter.route(\"adminDashboardUsersNew\", {\n  path: \"/admin/Users/new\",\n  template: \"AdminDashboardUsersNew\",\n  controller: 'AdminController',\n  action: function () {\n    return this.render();\n  },\n  onAfterAction: function () {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '创建新用户');\n    Session.set('admin_collection_page', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\nRouter.route(\"adminDashboardUsersEdit\", {\n  path: \"/admin/Users/:_id/edit\",\n  template: \"AdminDashboardUsersEdit\",\n  controller: \"AdminController\",\n  data: function () {\n    return {\n      user: Meteor.users.find(this.params._id).fetch(),\n      roles: Roles.getRolesForUser(this.params._id),\n      otherRoles: _.difference(_.map(Meteor.roles.find().fetch(), function (role) {\n        return role.name;\n      }), Roles.getRolesForUser(this.params._id))\n    };\n  },\n  action: function () {\n    return this.render();\n  },\n  onAfterAction: function () {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '编辑用户 ' + this.params._id);\n    Session.set('admin_collection_page', '');\n    Session.set('admin_collection_name', 'Users');\n    Session.set('admin_id', this.params._id);\n    return Session.set('admin_doc', Meteor.users.findOne({\n      _id: this.params._id\n    }));\n  }\n});","sourceMap":{"version":3,"sources":["/packages/wangziguan_admin/lib/both/router.coffee","/lib/both/router.coffee"],"names":["AdminController","RouteController","extend","layoutTemplate","waitOn","Meteor","subscribe","onBeforeAction","Session","set","Roles","userIsInRole","userId","call","AdminConfig","nonAdminRedirectRoute","Router","go","next","route","path","template","controller","action","render","onAfterAction","data","admin_table","AdminTables","Users","user","users","find","params","_id","fetch","roles","getRolesForUser","otherRoles","_","difference","map","role","name","findOne"],"mappings":"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","file":"packages/wangziguan:admin/lib/both/router.coffee.map","sourcesContent":["@AdminController = RouteController.extend\n\tlayoutTemplate: 'AdminLayout'\n\twaitOn: ->\n\t\t[\n\t\t\tMeteor.subscribe 'adminUsers'\n\t\t\tMeteor.subscribe 'adminUser'\n\t\t\tMeteor.subscribe 'adminCollectionsCount'\n\t\t]\n\tonBeforeAction: ->\n\t\tSession.set 'adminSuccess', null\n\t\tSession.set 'adminError', null\n\n\t\tSession.set 'admin_title', ''\n\t\tSession.set 'admin_subtitle', ''\n\t\tSession.set 'admin_collection_page', null\n\t\tSession.set 'admin_collection_name', null\n\t\tSession.set 'admin_id', null\n\t\tSession.set 'admin_doc', null\n\n\t\tif not Roles.userIsInRole Meteor.userId(), ['admin']\n\t\t\tMeteor.call 'adminCheckAdmin'\n\t\t\tif typeof AdminConfig?.nonAdminRedirectRoute == 'string'\n\t\t\t\tRouter.go AdminConfig.nonAdminRedirectRoute\n\n\t\t@next()\n\n\nRouter.route \"adminDashboard\",\n\tpath: \"/admin\"\n\ttemplate: \"AdminDashboard\"\n\tcontroller: \"AdminController\"\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '总览'\n\t\tSession.set 'admin_collection_name', ''\n\t\tSession.set 'admin_collection_page', ''\n\nRouter.route \"adminDashboardUsersView\",\n\tpath: \"/admin/Users\"\n\ttemplate: \"AdminDashboardView\"\n\tcontroller: \"AdminController\"\n\taction: ->\n\t\t@render()\n\tdata: ->\n\t\tadmin_table: AdminTables.Users\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\nRouter.route \"adminDashboardUsersNew\",\n\tpath: \"/admin/Users/new\"\n\ttemplate: \"AdminDashboardUsersNew\"\n\tcontroller: 'AdminController'\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', '创建新用户'\n\t\tSession.set 'admin_collection_page', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\nRouter.route \"adminDashboardUsersEdit\",\n\tpath: \"/admin/Users/:_id/edit\"\n\ttemplate: \"AdminDashboardUsersEdit\"\n\tcontroller: \"AdminController\"\n\tdata: ->\n\t\tuser: Meteor.users.find(@params._id).fetch()\n\t\troles: Roles.getRolesForUser @params._id\n\t\totherRoles: _.difference _.map(Meteor.roles.find().fetch(), (role) -> role.name), Roles.getRolesForUser(@params._id)\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', '编辑用户 ' + @params._id\n\t\tSession.set 'admin_collection_page', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\t\tSession.set 'admin_id', @params._id\n\t\tSession.set 'admin_doc', Meteor.users.findOne({_id:@params._id})\n","this.AdminController = RouteController.extend({\n  layoutTemplate: 'AdminLayout',\n  waitOn: function() {\n    return [Meteor.subscribe('adminUsers'), Meteor.subscribe('adminUser'), Meteor.subscribe('adminCollectionsCount')];\n  },\n  onBeforeAction: function() {\n    Session.set('adminSuccess', null);\n    Session.set('adminError', null);\n    Session.set('admin_title', '');\n    Session.set('admin_subtitle', '');\n    Session.set('admin_collection_page', null);\n    Session.set('admin_collection_name', null);\n    Session.set('admin_id', null);\n    Session.set('admin_doc', null);\n    if (!Roles.userIsInRole(Meteor.userId(), ['admin'])) {\n      Meteor.call('adminCheckAdmin');\n      if (typeof (typeof AdminConfig !== \"undefined\" && AdminConfig !== null ? AdminConfig.nonAdminRedirectRoute : void 0) === 'string') {\n        Router.go(AdminConfig.nonAdminRedirectRoute);\n      }\n    }\n    return this.next();\n  }\n});\n\nRouter.route(\"adminDashboard\", {\n  path: \"/admin\",\n  template: \"AdminDashboard\",\n  controller: \"AdminController\",\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '总览');\n    Session.set('admin_collection_name', '');\n    return Session.set('admin_collection_page', '');\n  }\n});\n\nRouter.route(\"adminDashboardUsersView\", {\n  path: \"/admin/Users\",\n  template: \"AdminDashboardView\",\n  controller: \"AdminController\",\n  action: function() {\n    return this.render();\n  },\n  data: function() {\n    return {\n      admin_table: AdminTables.Users\n    };\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\n\nRouter.route(\"adminDashboardUsersNew\", {\n  path: \"/admin/Users/new\",\n  template: \"AdminDashboardUsersNew\",\n  controller: 'AdminController',\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '创建新用户');\n    Session.set('admin_collection_page', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\n\nRouter.route(\"adminDashboardUsersEdit\", {\n  path: \"/admin/Users/:_id/edit\",\n  template: \"AdminDashboardUsersEdit\",\n  controller: \"AdminController\",\n  data: function() {\n    return {\n      user: Meteor.users.find(this.params._id).fetch(),\n      roles: Roles.getRolesForUser(this.params._id),\n      otherRoles: _.difference(_.map(Meteor.roles.find().fetch(), function(role) {\n        return role.name;\n      }), Roles.getRolesForUser(this.params._id))\n    };\n  },\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '编辑用户 ' + this.params._id);\n    Session.set('admin_collection_page', '');\n    Session.set('admin_collection_name', 'Users');\n    Session.set('admin_id', this.params._id);\n    return Session.set('admin_doc', Meteor.users.findOne({\n      _id: this.params._id\n    }));\n  }\n});\n"]}}