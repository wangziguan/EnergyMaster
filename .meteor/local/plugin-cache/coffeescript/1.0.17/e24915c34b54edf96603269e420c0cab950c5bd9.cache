{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar adminCollections;\n\nTemplate.registerHelper('AdminTables', AdminTables);\n\nadminCollections = function() {\n  var collections;\n  collections = {};\n  if (typeof AdminConfig !== 'undefined' && typeof AdminConfig.collections === 'object') {\n    collections = AdminConfig.collections;\n  }\n  collections.Users = {\n    collectionObject: Meteor.users,\n    icon: 'user',\n    label: '账号管理'\n  };\n  return _.map(collections, function(obj, key) {\n    obj = _.extend(obj, {\n      name: key\n    });\n    obj = _.defaults(obj, {\n      label: key,\n      icon: 'plus',\n      color: 'blue'\n    });\n    return obj = _.extend(obj, {\n      viewPath: Router.path(\"adminDashboard\" + key + \"View\"),\n      newPath: Router.path(\"adminDashboard\" + key + \"New\")\n    });\n  });\n};\n\nUI.registerHelper('AdminConfig', function() {\n  if (typeof AdminConfig !== 'undefined') {\n    return AdminConfig;\n  }\n});\n\nUI.registerHelper('admin_skin', function() {\n  return (typeof AdminConfig !== \"undefined\" && AdminConfig !== null ? AdminConfig.skin : void 0) || 'blue';\n});\n\nUI.registerHelper('admin_collections', adminCollections);\n\nUI.registerHelper('admin_collection_name', function() {\n  return Session.get('admin_collection_name');\n});\n\nUI.registerHelper('admin_current_id', function() {\n  return Session.get('admin_id');\n});\n\nUI.registerHelper('admin_current_doc', function() {\n  return Session.get('admin_doc');\n});\n\nUI.registerHelper('admin_is_users_collection', function() {\n  return Session.get('admin_collection_name') === 'Users';\n});\n\nUI.registerHelper('admin_sidebar_items', function() {\n  return AdminDashboard.sidebarItems;\n});\n\nUI.registerHelper('admin_collection_items', function() {\n  var items;\n  items = [];\n  _.each(AdminDashboard.collectionItems, (function(_this) {\n    return function(fn) {\n      var item;\n      item = fn(_this.name, '/admin/' + _this.name);\n      if ((item != null ? item.title : void 0) && (item != null ? item.url : void 0)) {\n        return items.push(item);\n      }\n    };\n  })(this));\n  return items;\n});\n\nUI.registerHelper('admin_omit_fields', function() {\n  var collection, global;\n  if (typeof AdminConfig.autoForm !== 'undefined' && typeof AdminConfig.autoForm.omitFields === 'object') {\n    global = AdminConfig.autoForm.omitFields;\n  }\n  if (!Session.equals('admin_collection_name', 'Users') && typeof AdminConfig !== 'undefined' && typeof AdminConfig.collections[Session.get('admin_collection_name')].omitFields === 'object') {\n    collection = AdminConfig.collections[Session.get('admin_collection_name')].omitFields;\n  }\n  if (typeof global === 'object' && typeof collection === 'object') {\n    return _.union(global, collection);\n  } else if (typeof global === 'object') {\n    return global;\n  } else if (typeof collection === 'object') {\n    return collection;\n  }\n});\n\nUI.registerHelper('AdminSchemas', function() {\n  return AdminDashboard.schemas;\n});\n\nUI.registerHelper('adminGetSkin', function() {\n  if (typeof AdminConfig.dashboard !== 'undefined' && typeof AdminConfig.dashboard.skin === 'string') {\n    return AdminConfig.dashboard.skin;\n  } else {\n    return 'blue';\n  }\n});\n\nUI.registerHelper('adminIsUserInRole', function(_id, role) {\n  return Roles.userIsInRole(_id, role);\n});\n\nUI.registerHelper('adminGetUsers', function() {\n  return Meteor.users;\n});\n\nUI.registerHelper('adminGetUserSchema', function() {\n  var schema;\n  if (_.has(AdminConfig, 'userSchema')) {\n    schema = AdminConfig.userSchema;\n  } else if (typeof Meteor.users._c2 === 'object') {\n    schema = Meteor.users.simpleSchema();\n  }\n  return schema;\n});\n\nUI.registerHelper('adminCollectionLabel', function(collection) {\n  if (collection != null) {\n    return AdminDashboard.collectionLabel(collection);\n  }\n});\n\nUI.registerHelper('adminCollectionCount', function(collection) {\n  var ref;\n  if (collection === 'Users') {\n    return Meteor.users.find().count();\n  } else {\n    return (ref = AdminCollectionsCount.findOne({\n      collection: collection\n    })) != null ? ref.count : void 0;\n  }\n});\n\nUI.registerHelper('adminTemplate', function(collection, mode) {\n  var ref, ref1;\n  if ((collection != null ? collection.toLowerCase() : void 0) !== 'users' && typeof (typeof AdminConfig !== \"undefined\" && AdminConfig !== null ? (ref = AdminConfig.collections) != null ? (ref1 = ref[collection]) != null ? ref1.templates : void 0 : void 0 : void 0) !== 'undefined') {\n    return AdminConfig.collections[collection].templates[mode];\n  }\n});\n\nUI.registerHelper('adminGetCollection', function(collection) {\n  return _.find(adminCollections(), function(item) {\n    return item.name === collection;\n  });\n});\n\nUI.registerHelper('adminWidgets', function() {\n  if (typeof AdminConfig.dashboard !== 'undefined' && typeof AdminConfig.dashboard.widgets !== 'undefined') {\n    return AdminConfig.dashboard.widgets;\n  }\n});\n\nUI.registerHelper('adminUserEmail', function(user) {\n  if (user && user.emails && user.emails[0] && user.emails[0].address) {\n    return user.emails[0].address;\n  } else if (user && user.services && user.services.facebook && user.services.facebook.email) {\n    return user.services.facebook.email;\n  } else if (user && user.services && user.services.google && user.services.google.email) {\n    return user.services.google.email;\n  }\n});\n","sourceMap":{"version":3,"file":"/lib/client/js/helpers.coffee.js","sourceRoot":"","sources":["/packages/wangziguan_admin/lib/client/js/helpers.coffee"],"names":[],"mappings":"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","sourcesContent":["Template.registerHelper('AdminTables', AdminTables);\n\nadminCollections = ->\n\tcollections = {}\n\n\tif typeof AdminConfig != 'undefined'  and typeof AdminConfig.collections == 'object'\n\t\tcollections = AdminConfig.collections\n\n\tcollections.Users =\n\t\tcollectionObject: Meteor.users\n\t\ticon: 'user'\n\t\tlabel: '账号管理'\n\n\t_.map collections, (obj, key) ->\n\t\tobj = _.extend obj, {name: key}\n\t\tobj = _.defaults obj, {label: key, icon: 'plus', color: 'blue'}\n\t\tobj = _.extend obj,\n\t\t\tviewPath: Router.path \"adminDashboard#{key}View\"\n\t\t\tnewPath: Router.path \"adminDashboard#{key}New\"\n\nUI.registerHelper 'AdminConfig', ->\n\tAdminConfig if typeof AdminConfig != 'undefined'\n\nUI.registerHelper 'admin_skin', ->\n\tAdminConfig?.skin or 'blue'\n\nUI.registerHelper 'admin_collections', adminCollections\n\nUI.registerHelper 'admin_collection_name', ->\n\tSession.get 'admin_collection_name'\n\nUI.registerHelper 'admin_current_id', ->\n\tSession.get 'admin_id'\n\nUI.registerHelper 'admin_current_doc', ->\n\tSession.get 'admin_doc'\n\nUI.registerHelper 'admin_is_users_collection', ->\n\tSession.get('admin_collection_name') == 'Users'\n\nUI.registerHelper 'admin_sidebar_items', ->\n\tAdminDashboard.sidebarItems\n\nUI.registerHelper 'admin_collection_items', ->\n\titems = []\n\t_.each AdminDashboard.collectionItems, (fn) =>\n\t\titem = fn @name, '/admin/' + @name\n\t\tif item?.title and item?.url\n\t\t\titems.push item\n\titems\n\nUI.registerHelper 'admin_omit_fields', ->\n\tif typeof AdminConfig.autoForm != 'undefined' and typeof AdminConfig.autoForm.omitFields == 'object'\n\t\tglobal = AdminConfig.autoForm.omitFields\n\tif not Session.equals('admin_collection_name','Users') and typeof AdminConfig != 'undefined' and typeof AdminConfig.collections[Session.get 'admin_collection_name'].omitFields == 'object'\n\t\tcollection = AdminConfig.collections[Session.get 'admin_collection_name'].omitFields\n\tif typeof global == 'object' and typeof collection == 'object'\n\t\t_.union global, collection\n\telse if typeof global == 'object'\n\t\tglobal\n\telse if typeof collection == 'object'\n\t\tcollection\n\nUI.registerHelper 'AdminSchemas', ->\n\tAdminDashboard.schemas\n\nUI.registerHelper 'adminGetSkin', ->\n\tif typeof AdminConfig.dashboard != 'undefined' and typeof AdminConfig.dashboard.skin == 'string'\n\t\tAdminConfig.dashboard.skin\n\telse\n\t\t'blue'\n\nUI.registerHelper 'adminIsUserInRole', (_id,role)->\n\tRoles.userIsInRole _id, role\n\nUI.registerHelper 'adminGetUsers', ->\n\tMeteor.users\n\nUI.registerHelper 'adminGetUserSchema', ->\n\tif _.has(AdminConfig, 'userSchema')\n\t\tschema = AdminConfig.userSchema\n\telse if typeof Meteor.users._c2 == 'object'\n\t\tschema = Meteor.users.simpleSchema()\n\n\treturn schema\n\nUI.registerHelper 'adminCollectionLabel', (collection)->\n\tAdminDashboard.collectionLabel(collection) if collection?\n\nUI.registerHelper 'adminCollectionCount', (collection)->\n\tif collection == 'Users'\n\t\tMeteor.users.find().count()\n\telse\n\t\tAdminCollectionsCount.findOne({collection: collection})?.count\n\nUI.registerHelper 'adminTemplate', (collection, mode)->\n\tif collection?.toLowerCase() != 'users' && typeof AdminConfig?.collections?[collection]?.templates != 'undefined'\n\t\tAdminConfig.collections[collection].templates[mode]\n\nUI.registerHelper 'adminGetCollection', (collection)->\n\t_.find adminCollections(), (item) -> item.name == collection\n\nUI.registerHelper 'adminWidgets', ->\n\tif typeof AdminConfig.dashboard != 'undefined' and typeof AdminConfig.dashboard.widgets != 'undefined'\n\t\tAdminConfig.dashboard.widgets\n\nUI.registerHelper 'adminUserEmail', (user) ->\n\tif user && user.emails && user.emails[0] && user.emails[0].address\n\t\tuser.emails[0].address\n\telse if user && user.services && user.services.facebook && user.services.facebook.email\n\t\tuser.services.facebook.email\n\telse if user && user.services && user.services.google && user.services.google.email\n\t\tuser.services.google.email\n"]}}