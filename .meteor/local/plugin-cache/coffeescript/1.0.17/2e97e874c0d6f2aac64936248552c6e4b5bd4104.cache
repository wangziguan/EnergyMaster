{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nthis.AdminController = RouteController.extend({\n  layoutTemplate: 'AdminLayout',\n  waitOn: function() {\n    return [Meteor.subscribe('adminUsers'), Meteor.subscribe('adminUser'), Meteor.subscribe('adminCollectionsCount')];\n  },\n  onBeforeAction: function() {\n    Session.set('adminSuccess', null);\n    Session.set('adminError', null);\n    Session.set('admin_title', '');\n    Session.set('admin_subtitle', '');\n    Session.set('admin_collection_page', null);\n    Session.set('admin_collection_name', null);\n    Session.set('admin_id', null);\n    Session.set('admin_doc', null);\n    if (!Roles.userIsInRole(Meteor.userId(), ['admin'])) {\n      Meteor.call('adminCheckAdmin');\n      if (typeof (typeof AdminConfig !== \"undefined\" && AdminConfig !== null ? AdminConfig.nonAdminRedirectRoute : void 0) === 'string') {\n        Router.go(AdminConfig.nonAdminRedirectRoute);\n      }\n    }\n    return this.next();\n  }\n});\n\nRouter.route(\"adminDashboard\", {\n  path: \"/admin\",\n  template: \"AdminDashboard\",\n  controller: \"AdminController\",\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '总览');\n    Session.set('admin_collection_name', '');\n    return Session.set('admin_collection_page', '');\n  }\n});\n\nRouter.route(\"adminDashboardUsersView\", {\n  path: \"/admin/Users\",\n  template: \"AdminDashboardView\",\n  controller: \"AdminController\",\n  action: function() {\n    return this.render();\n  },\n  data: function() {\n    return {\n      admin_table: AdminTables.Users\n    };\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\n\nRouter.route(\"adminDashboardUsersNew\", {\n  path: \"/admin/Users/new\",\n  template: \"AdminDashboardUsersNew\",\n  controller: 'AdminController',\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '创建新用户');\n    Session.set('admin_collection_page', '');\n    return Session.set('admin_collection_name', 'Users');\n  }\n});\n\nRouter.route(\"adminDashboardUsersEdit\", {\n  path: \"/admin/Users/:_id/edit\",\n  template: \"AdminDashboardUsersEdit\",\n  controller: \"AdminController\",\n  data: function() {\n    return {\n      user: Meteor.users.find(this.params._id).fetch(),\n      roles: Roles.getRolesForUser(this.params._id),\n      otherRoles: _.difference(_.map(Meteor.roles.find().fetch(), function(role) {\n        return role.name;\n      }), Roles.getRolesForUser(this.params._id))\n    };\n  },\n  action: function() {\n    return this.render();\n  },\n  onAfterAction: function() {\n    Session.set('admin_title', '账号管理');\n    Session.set('admin_subtitle', '编辑用户 ' + this.params._id);\n    Session.set('admin_collection_page', '');\n    Session.set('admin_collection_name', 'Users');\n    Session.set('admin_id', this.params._id);\n    return Session.set('admin_doc', Meteor.users.findOne({\n      _id: this.params._id\n    }));\n  }\n});\n","sourceMap":{"version":3,"file":"/lib/both/router.coffee.js","sourceRoot":"","sources":["/packages/wangziguan_admin/lib/both/router.coffee"],"names":[],"mappings":"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","sourcesContent":["@AdminController = RouteController.extend\n\tlayoutTemplate: 'AdminLayout'\n\twaitOn: ->\n\t\t[\n\t\t\tMeteor.subscribe 'adminUsers'\n\t\t\tMeteor.subscribe 'adminUser'\n\t\t\tMeteor.subscribe 'adminCollectionsCount'\n\t\t]\n\tonBeforeAction: ->\n\t\tSession.set 'adminSuccess', null\n\t\tSession.set 'adminError', null\n\n\t\tSession.set 'admin_title', ''\n\t\tSession.set 'admin_subtitle', ''\n\t\tSession.set 'admin_collection_page', null\n\t\tSession.set 'admin_collection_name', null\n\t\tSession.set 'admin_id', null\n\t\tSession.set 'admin_doc', null\n\n\t\tif not Roles.userIsInRole Meteor.userId(), ['admin']\n\t\t\tMeteor.call 'adminCheckAdmin'\n\t\t\tif typeof AdminConfig?.nonAdminRedirectRoute == 'string'\n\t\t\t\tRouter.go AdminConfig.nonAdminRedirectRoute\n\n\t\t@next()\n\n\nRouter.route \"adminDashboard\",\n\tpath: \"/admin\"\n\ttemplate: \"AdminDashboard\"\n\tcontroller: \"AdminController\"\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '总览'\n\t\tSession.set 'admin_collection_name', ''\n\t\tSession.set 'admin_collection_page', ''\n\nRouter.route \"adminDashboardUsersView\",\n\tpath: \"/admin/Users\"\n\ttemplate: \"AdminDashboardView\"\n\tcontroller: \"AdminController\"\n\taction: ->\n\t\t@render()\n\tdata: ->\n\t\tadmin_table: AdminTables.Users\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\nRouter.route \"adminDashboardUsersNew\",\n\tpath: \"/admin/Users/new\"\n\ttemplate: \"AdminDashboardUsersNew\"\n\tcontroller: 'AdminController'\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', '创建新用户'\n\t\tSession.set 'admin_collection_page', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\nRouter.route \"adminDashboardUsersEdit\",\n\tpath: \"/admin/Users/:_id/edit\"\n\ttemplate: \"AdminDashboardUsersEdit\"\n\tcontroller: \"AdminController\"\n\tdata: ->\n\t\tuser: Meteor.users.find(@params._id).fetch()\n\t\troles: Roles.getRolesForUser @params._id\n\t\totherRoles: _.difference _.map(Meteor.roles.find().fetch(), (role) -> role.name), Roles.getRolesForUser(@params._id)\n\taction: ->\n\t\t@render()\n\tonAfterAction: ->\n\t\tSession.set 'admin_title', '账号管理'\n\t\tSession.set 'admin_subtitle', '编辑用户 ' + @params._id\n\t\tSession.set 'admin_collection_page', ''\n\t\tSession.set 'admin_collection_name', 'Users'\n\t\tSession.set 'admin_id', @params._id\n\t\tSession.set 'admin_doc', Meteor.users.findOne({_id:@params._id})\n"]}}