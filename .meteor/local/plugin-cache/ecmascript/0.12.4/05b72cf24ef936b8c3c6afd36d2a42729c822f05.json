{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/wangziguan/wzg/EnergyMaster/packages/aldeed:autoform/autoform-arrays.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/aldeed:autoform/autoform-arrays.js","filename":"/home/wangziguan/wzg/EnergyMaster/packages/aldeed:autoform/autoform-arrays.js","passPerPreset":false,"envName":"development","cwd":"/home/wangziguan/wzg/EnergyMaster","root":"/home/wangziguan/wzg/EnergyMaster","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"/home/wangziguan/wzg/EnergyMaster/packages/aldeed:autoform/autoform-arrays.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/aldeed:autoform/autoform-arrays.js"}},"code":"// Track arrays; this allows us to add/remove fields or groups of fields for an array\n// but still easily respect minCount and maxCount, and properly add/remove the same\n// items from the database once the form is submitted.\nArrayTracker = function () {\n  function afArrayTracker() {\n    var self = this;\n    self.info = {};\n  }\n\n  return afArrayTracker;\n}();\n\nArrayTracker.prototype.getMinMax = function () {\n  function atGetMinMax(ss, field, overrideMinCount, overrideMaxCount) {\n    var defs = AutoForm.Utility.getFieldDefinition(ss, field); // minCount is set by the schema, but can be set higher on the field attribute\n\n    overrideMinCount = overrideMinCount || 0;\n    var minCount = defs.minCount || 0;\n    minCount = Math.max(overrideMinCount, minCount); // maxCount is set by the schema, but can be set lower on the field attribute\n\n    overrideMaxCount = overrideMaxCount || Infinity;\n    var maxCount = defs.maxCount || Infinity;\n    maxCount = Math.min(overrideMaxCount, maxCount);\n    return {\n      minCount: minCount,\n      maxCount: maxCount\n    };\n  }\n\n  return atGetMinMax;\n}();\n\nArrayTracker.prototype.initForm = function () {\n  function atInitForm(formId) {\n    var self = this;\n    if (self.info[formId]) return;\n    self.info[formId] = {};\n  }\n\n  return atInitForm;\n}();\n\nArrayTracker.prototype.getForm = function () {\n  function atInitForm(formId) {\n    var self = this;\n    self.initForm(formId);\n    return self.info[formId];\n  }\n\n  return atInitForm;\n}();\n\nArrayTracker.prototype.ensureField = function () {\n  function atEnsureField(formId, field) {\n    var self = this;\n    self.initForm(formId);\n    if (!self.info[formId][field]) self.resetField(formId, field);\n  }\n\n  return atEnsureField;\n}();\n\nArrayTracker.prototype.initField = function () {\n  function atInitField(formId, field, ss, docCount, overrideMinCount, overrideMaxCount) {\n    var self = this;\n    self.ensureField(formId, field);\n    if (self.info[formId][field].array != null) return; // If we have a doc: The count should be the maximum of docCount or schema minCount or field minCount or 1.\n    // If we don't have a doc: The count should be the maximum of schema minCount or field minCount or 1.\n\n    var range = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount);\n    var arrayCount = Math.max(range.minCount, docCount == null ? 1 : docCount); // If this is an array of objects, collect names of object props\n\n    var childKeys = [];\n\n    if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n      childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n    }\n\n    var loopArray = [];\n\n    for (var i = 0; i < arrayCount; i++) {\n      var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n      loopArray.push(loopCtx);\n    }\n\n    self.info[formId][field].array = loopArray;\n    var count = loopArray.length;\n    self.info[formId][field].count = count;\n    self.info[formId][field].visibleCount = count;\n    self.info[formId][field].deps.changed();\n  }\n\n  return atInitField;\n}();\n\nArrayTracker.prototype.resetField = function () {\n  function atResetField(formId, field) {\n    var self = this;\n    self.initForm(formId);\n\n    if (!self.info[formId][field]) {\n      self.info[formId][field] = {\n        deps: new Tracker.Dependency()\n      };\n    }\n\n    self.info[formId][field].array = null;\n    self.info[formId][field].count = 0;\n    self.info[formId][field].visibleCount = 0;\n    self.info[formId][field].deps.changed();\n  }\n\n  return atResetField;\n}();\n\nArrayTracker.prototype.resetForm = function () {\n  function atResetForm(formId) {\n    var self = this;\n\n    _.each(self.info[formId], function (info, field) {\n      self.resetField(formId, field);\n    });\n  }\n\n  return atResetForm;\n}();\n\nArrayTracker.prototype.untrackForm = function () {\n  function atUntrackForm(formId) {\n    var self = this;\n    self.info[formId] = {};\n  }\n\n  return atUntrackForm;\n}();\n\nArrayTracker.prototype.tracksField = function () {\n  function atTracksField(formId, field) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n    return !!self.info[formId][field].array;\n  }\n\n  return atTracksField;\n}();\n\nArrayTracker.prototype.getField = function () {\n  function atGetField(formId, field) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n    return self.info[formId][field].array;\n  }\n\n  return atGetField;\n}();\n\nArrayTracker.prototype.getCount = function () {\n  function atGetCount(formId, field) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n    return self.info[formId][field].count;\n  }\n\n  return atGetCount;\n}();\n\nArrayTracker.prototype.getVisibleCount = function () {\n  function atGetVisibleCount(formId, field) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n    return self.info[formId][field].visibleCount;\n  }\n\n  return atGetVisibleCount;\n}();\n\nArrayTracker.prototype.isFirstFieldlVisible = function () {\n  function atIsFirstFieldlVisible(formId, field, currentIndex) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n\n    var firstVisibleField = _.find(self.info[formId][field].array, function (currentField) {\n      return !currentField.removed;\n    });\n\n    return firstVisibleField && firstVisibleField.index === currentIndex;\n  }\n\n  return atIsFirstFieldlVisible;\n}();\n\nArrayTracker.prototype.isLastFieldlVisible = function () {\n  function atIsLastFieldlVisible(formId, field, currentIndex) {\n    var self = this;\n    self.ensureField(formId, field);\n    self.info[formId][field].deps.depend();\n\n    var lastVisibleField = _.last(_.filter(self.info[formId][field].array, function (currentField) {\n      return !currentField.removed;\n    }));\n\n    return lastVisibleField && lastVisibleField.index === currentIndex;\n  }\n\n  return atIsLastFieldlVisible;\n}();\n\nArrayTracker.prototype.addOneToField = function () {\n  function atAddOneToField(formId, field, ss, overrideMinCount, overrideMaxCount) {\n    var self = this;\n    self.ensureField(formId, field);\n    if (!self.info[formId][field].array) return;\n    var currentCount = self.info[formId][field].visibleCount;\n    var maxCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).maxCount;\n\n    if (currentCount < maxCount) {\n      var i = self.info[formId][field].array.length; // If this is an array of objects, collect names of object props\n\n      var childKeys = [];\n\n      if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n        childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n      }\n\n      var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n      self.info[formId][field].array.push(loopCtx);\n      self.info[formId][field].count++;\n      self.info[formId][field].visibleCount++;\n      self.info[formId][field].deps.changed();\n    }\n  }\n\n  return atAddOneToField;\n}();\n\nArrayTracker.prototype.removeFromFieldAtIndex = function () {\n  function atRemoveFromFieldAtIndex(formId, field, index, ss, overrideMinCount, overrideMaxCount) {\n    var self = this;\n    self.ensureField(formId, field);\n    if (!self.info[formId][field].array) return;\n    var currentCount = self.info[formId][field].visibleCount;\n    var minCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).minCount;\n\n    if (currentCount > minCount) {\n      self.info[formId][field].array[index].removed = true;\n      self.info[formId][field].count--;\n      self.info[formId][field].visibleCount--;\n      self.info[formId][field].deps.changed();\n    }\n  }\n\n  return atRemoveFromFieldAtIndex;\n}();\n/*\n * PRIVATE\n */\n\n\nvar createLoopCtx = function (formId, field, index, childKeys, overrideMinCount, overrideMaxCount) {\n  var loopCtx = {\n    formId: formId,\n    arrayFieldName: field,\n    name: field + '.' + index,\n    index: index,\n    minCount: overrideMinCount,\n    maxCount: overrideMaxCount\n  }; // If this is an array of objects, add child key names under loopCtx.current[childName] = fullKeyName\n\n  if (childKeys.length) {\n    loopCtx.current = {};\n\n    _.each(childKeys, function (k) {\n      loopCtx.current[k] = field + '.' + index + '.' + k;\n    });\n  }\n\n  return loopCtx;\n};","map":{"version":3,"sources":["packages/aldeed:autoform/autoform-arrays.js"],"names":["ArrayTracker","afArrayTracker","self","info","prototype","getMinMax","atGetMinMax","ss","field","overrideMinCount","overrideMaxCount","defs","AutoForm","Utility","getFieldDefinition","minCount","Math","max","Infinity","maxCount","min","initForm","atInitForm","formId","getForm","ensureField","atEnsureField","resetField","initField","atInitField","docCount","array","range","arrayCount","childKeys","type","Object","objectKeys","makeKeyGeneric","loopArray","i","loopCtx","createLoopCtx","push","count","length","visibleCount","deps","changed","atResetField","Tracker","Dependency","resetForm","atResetForm","_","each","untrackForm","atUntrackForm","tracksField","atTracksField","depend","getField","atGetField","getCount","atGetCount","getVisibleCount","atGetVisibleCount","isFirstFieldlVisible","atIsFirstFieldlVisible","currentIndex","firstVisibleField","find","currentField","removed","index","isLastFieldlVisible","atIsLastFieldlVisible","lastVisibleField","last","filter","addOneToField","atAddOneToField","currentCount","removeFromFieldAtIndex","atRemoveFromFieldAtIndex","arrayFieldName","name","current","k"],"mappings":"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","sourcesContent":["// Track arrays; this allows us to add/remove fields or groups of fields for an array\n// but still easily respect minCount and maxCount, and properly add/remove the same\n// items from the database once the form is submitted.\n\nArrayTracker = function afArrayTracker() {\n  var self = this;\n  self.info = {};\n};\n\nArrayTracker.prototype.getMinMax = function atGetMinMax(ss, field, overrideMinCount, overrideMaxCount) {\n  var defs = AutoForm.Utility.getFieldDefinition(ss, field);\n\n  // minCount is set by the schema, but can be set higher on the field attribute\n  overrideMinCount = overrideMinCount || 0;\n  var minCount = defs.minCount || 0;\n  minCount = Math.max(overrideMinCount, minCount);\n\n  // maxCount is set by the schema, but can be set lower on the field attribute\n  overrideMaxCount = overrideMaxCount || Infinity;\n  var maxCount = defs.maxCount || Infinity;\n  maxCount = Math.min(overrideMaxCount, maxCount);\n\n  return { minCount: minCount, maxCount: maxCount };\n};\n\nArrayTracker.prototype.initForm = function atInitForm(formId) {\n  var self = this;\n\n  if (self.info[formId]) return;\n\n  self.info[formId] = {};\n};\n\nArrayTracker.prototype.getForm = function atInitForm(formId) {\n  var self = this;\n  self.initForm(formId);\n  return self.info[formId];\n};\n\nArrayTracker.prototype.ensureField = function atEnsureField(formId, field) {\n  var self = this;\n  self.initForm(formId);\n\n  if (!self.info[formId][field]) self.resetField(formId, field);\n};\n\nArrayTracker.prototype.initField = function atInitField(formId, field, ss, docCount, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (self.info[formId][field].array != null) return;\n\n// If we have a doc: The count should be the maximum of docCount or schema minCount or field minCount or 1.\n// If we don't have a doc: The count should be the maximum of schema minCount or field minCount or 1.\n  var range = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount);\n  var arrayCount = Math.max(range.minCount, (docCount == null) ? 1 : docCount);\n\n// If this is an array of objects, collect names of object props\n  var childKeys = [];\n  if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n    childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n\t}\n\n  var loopArray = [];\n  for (var i = 0; i < arrayCount; i++) {\n    var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n    loopArray.push(loopCtx);\n  }\n\n  self.info[formId][field].array = loopArray;\n  var count = loopArray.length;\n  self.info[formId][field].count = count;\n  self.info[formId][field].visibleCount = count;\n  self.info[formId][field].deps.changed();\n};\n\nArrayTracker.prototype.resetField = function atResetField(formId, field) {\n  var self = this;\n  self.initForm(formId);\n\n  if (!self.info[formId][field]) {\n    self.info[formId][field] = {\n      deps: new Tracker.Dependency()\n\t\t};\n\t}\n\n  self.info[formId][field].array = null;\n  self.info[formId][field].count = 0;\n  self.info[formId][field].visibleCount = 0;\n  self.info[formId][field].deps.changed();\n};\n\nArrayTracker.prototype.resetForm = function atResetForm(formId) {\n  var self = this;\n  _.each(self.info[formId], function (info, field) {\n    self.resetField(formId, field);\n\t});\n};\n\nArrayTracker.prototype.untrackForm = function atUntrackForm(formId) {\n  var self = this;\n  self.info[formId] = {};\n};\n\nArrayTracker.prototype.tracksField = function atTracksField(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return !!self.info[formId][field].array;\n};\n\nArrayTracker.prototype.getField = function atGetField(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].array;\n};\n\nArrayTracker.prototype.getCount = function atGetCount(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].count;\n};\n\nArrayTracker.prototype.getVisibleCount = function atGetVisibleCount(formId, field) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  return self.info[formId][field].visibleCount;\n};\n\nArrayTracker.prototype.isFirstFieldlVisible = function atIsFirstFieldlVisible(formId, field, currentIndex) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  var firstVisibleField = _.find(self.info[formId][field].array, function(currentField) {\n    return !currentField.removed;\n\t});\n\treturn (firstVisibleField && firstVisibleField.index === currentIndex);\n};\n\nArrayTracker.prototype.isLastFieldlVisible = function atIsLastFieldlVisible(formId, field, currentIndex) {\n  var self = this;\n  self.ensureField(formId, field);\n  self.info[formId][field].deps.depend();\n  var lastVisibleField = _.last(_.filter(self.info[formId][field].array, function(currentField) {\n    return !currentField.removed;\n\t}));\n  return (lastVisibleField && lastVisibleField.index === currentIndex);\n};\n\nArrayTracker.prototype.addOneToField = function atAddOneToField(formId, field, ss, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (!self.info[formId][field].array) return;\n\n  var currentCount = self.info[formId][field].visibleCount;\n  var maxCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).maxCount;\n\n  if (currentCount < maxCount) {\n    var i = self.info[formId][field].array.length;\n\n    // If this is an array of objects, collect names of object props\n    var childKeys = [];\n    if (AutoForm.Utility.getFieldDefinition(ss, field + '.$').type === Object) {\n      childKeys = ss.objectKeys(AutoForm.Utility.makeKeyGeneric(field) + '.$');\n\t  }\n\n    var loopCtx = createLoopCtx(formId, field, i, childKeys, overrideMinCount, overrideMaxCount);\n\n    self.info[formId][field].array.push(loopCtx);\n    self.info[formId][field].count++;\n    self.info[formId][field].visibleCount++;\n    self.info[formId][field].deps.changed();\n  }\n};\n\nArrayTracker.prototype.removeFromFieldAtIndex = function atRemoveFromFieldAtIndex(formId, field, index, ss, overrideMinCount, overrideMaxCount) {\n  var self = this;\n  self.ensureField(formId, field);\n\n  if (!self.info[formId][field].array) return;\n\n  var currentCount = self.info[formId][field].visibleCount;\n  var minCount = self.getMinMax(ss, field, overrideMinCount, overrideMaxCount).minCount;\n\n  if (currentCount > minCount) {\n    self.info[formId][field].array[index].removed = true;\n    self.info[formId][field].count--;\n    self.info[formId][field].visibleCount--;\n    self.info[formId][field].deps.changed();\n  }\n};\n\n/*\n * PRIVATE\n */\nvar createLoopCtx = function(formId, field, index, childKeys, overrideMinCount, overrideMaxCount) {\n  var loopCtx = {\n    formId:         formId,\n    arrayFieldName: field,\n    name:           field + '.' + index,\n    index:          index,\n    minCount:       overrideMinCount,\n    maxCount:       overrideMaxCount\n  };\n\n  // If this is an array of objects, add child key names under loopCtx.current[childName] = fullKeyName\n  if (childKeys.length) {\n    loopCtx.current = {};\n    _.each(childKeys, function (k) {\n      loopCtx.current[k] = field + '.' + index + '.' + k;\n    });\n  }\n\n  return loopCtx;\n};\n"]},"sourceType":"script","hash":"05b72cf24ef936b8c3c6afd36d2a42729c822f05"}
