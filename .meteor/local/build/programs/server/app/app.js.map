{"version":3,"sources":["meteor://💻app/imports/api/devices/server/publications.js","meteor://💻app/imports/api/devices/lists.js","meteor://💻app/imports/api/devices/methods.js","meteor://💻app/imports/api/mqtts/server/publications.js","meteor://💻app/imports/api/mqtts/lists.js","meteor://💻app/imports/api/mqtts/methods.js","meteor://💻app/imports/startup/both/_settings.js","meteor://💻app/imports/startup/both/index.js","meteor://💻app/imports/startup/both/schemas.js","meteor://💻app/imports/startup/server/admin.js","meteor://💻app/imports/startup/server/email.js","meteor://💻app/imports/startup/server/index.js","meteor://💻app/imports/startup/server/mqtt-connect.js","meteor://💻app/imports/startup/server/routers.js","meteor://💻app/server/main.js"],"names":["Meteor","module","link","v","publish","DeviceList","find","uid","search","limit","skip","select","imei","console","log","Mongo","Collection","methods","clientId","isUser","findOne","e","count","MqttMessages","GeneralMessages","EnergyMessages","WavesampleMessages","ValidatedMethod","SimpleSchema","default","connect","name","validate","topic","String","validator","run","unblock","mqttConnect","settings","mqttURL","insert","raw","_","defaults","mqttTopic","elasticSearchURL","AppURL","Schemas","Accounts","Roles","startup","users","username","createUser","email","password","addUsersToRoles","GLOBAL_GROUP","emailTemplates","siteName","from","call","Router","fs","route","title","headers","filepath","Assets","absoluteFilePath","response","writeHead","end","readFileSync","where","request"],"mappings":"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","file":"/app.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nMeteor.publish(\"deviceList\", function () {\n    return DeviceList.find();\n});\n\nMeteor.publish(\"currentDeviceList\", function (uid, search, limit, skip) {\n    const select = {};\n    if (search) {\n        if(search.imei) {\n            console.log(search.imei);\n            select.imei = search.imei;\n        }    \n    }\n    \n    return DeviceList.find(select, {limit: limit, skip: skip});\n});","import { Mongo } from 'meteor/mongo';\n\nDeviceList = new Mongo.Collection(\"deviceList\");\n/**\n{\n    _id:\n    \"clientId\": \"1\",\n    \"location\": \"上海交通大学电信裙楼4-325\",\n    \"imei\": \"012345678901234\",\n    \"createAt\": new Date(),\n}\n*/","Meteor.methods({\n    \"checkClientId\": function (clientId) {\n        try {\n            const isUser = DeviceList.findOne({clientId: clientId});\n            if (isUser) {\n                return \"ClientId is not null\";\n            }  \n            else{\n                // console.log(\"ClientId is not found\");\n            }\n        } catch (e) {\n            // insertLog(e.message, e.stack);\n        }\n    },\n\n    \"checkImei\": function (imei) {\n        try {\n            const isUser = DeviceList.findOne({imei: imei});\n            if (isUser) {\n                return \"Imei is not null\";\n            }\n            else{\n                // console.log(\"Imei is not found\");\n            }    \n        } catch (e) {\n            // insertLog(e.message, e.stack);\n        }\n    },\n\n    \"deviceListCount\": function (search) {\n        try {\n            var select = {};\n            if (search) {\n                if (search.imei) {\n                    select.imei = search.imei;\n                }\n            }\n            return DeviceList.find(select).count();\n        } catch (e) {\n            // insertLog(e.message, e.stack);\n        }\n    },\n    \n});","import { Meteor } from 'meteor/meteor';\n\nMeteor.publish(\"mqtt_messages\", function () {\n    return MqttMessages.find();\n});\n\nMeteor.publish(\"general_messages\", function () {\n    return GeneralMessages.find();\n});\n\nMeteor.publish(\"energy_messages\", function () {\n    return EnergyMessages.find();\n});\n\nMeteor.publish(\"wavesample_messages\", function () {\n    return WavesampleMessages.find();\n});","import { Mongo } from 'meteor/mongo';\n\nMqttMessages = new Mongo.Collection(\"mqtt_messages\");\n/**\n{\n    _id:\n    \"topic\": \"ADE7953/012345678901234/out\",   \n    \"payload\": \"01010203040102030401020304010203040102030401020102fe\",\n    \"payload\": \"02010203040102030401020304fe\",\n    \"payload\": \"03(010203)x280...fe\",\n    \"createAt\": new Date(),\n}\n*/\n\nGeneralMessages = new Mongo.Collection(\"general_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"voltage\": \"220.05\",\n    \"current\": \"1.05\",\n    \"watt\": \"220.05\",\n    \"var\": \"1.05\",\n    \"va\": \"223.10\",\n    \"f\": \"50.02\",\n    \"period\": \"19.98\",\n    \"createAt\": new Date(),\n}\n*/\n\nEnergyMessages = new Mongo.Collection(\"energy_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"aenergy\": \"100.59\",\n    \"renergy\": \"10.32\",\n    \"apenergy\": \"110.03\",\n    \"createAt\": new Date(),\n}\n*/\n\nWavesampleMessages = new Mongo.Collection(\"wavesample_messages\");\n/**\n{\n    _id:\n    \"imei\": \"012345678901234\",\n    \"samples\": [1.00, 1.01, ..., 1.03], // 280\n    \"createAt\": new Date(),\n}\n*/","import { Meteor } from 'meteor/meteor';\nimport { ValidatedMethod } from 'meteor/mdg:validated-method';\nimport SimpleSchema from 'simpl-schema';\n\nconnect = new ValidatedMethod({\n    name: 'mqtts.connect',\n    validate: new SimpleSchema({\n        topic: String,\n    }).validator(),\n\n    run({ topic }) {\n        this.unblock();\n        MqttMessages.mqttConnect(Meteor.settings.mqttURL, topic, {\n            insert: true,\n            raw: false\n        })\n    },\n})","// Meteor.settings默认设置\nimport { Meteor } from 'meteor/meteor';\n\nif (typeof Meteor.settings === 'undefined'){\n  Meteor.settings = {};\n}\n\n_.defaults(Meteor.settings, {\n  mqttTopic: \"ADE7953/#\",\n  // mqttURL: \"http://47.106.72.131:1883\",\n  mqttURL: \"http://58.196.128.13:1883\",\n  elasticSearchURL: \"http://47.106.72.131:9200\",\n  AppURL: \"http://47.106.72.131:3000/\",\n})","import './_settings.js';\nimport './schemas.js';\n\nimport '../../api/devices/lists.js';\nimport '../../api/mqtts/lists.js';\nimport '../../api/devices/methods.js';\nimport '../../api/mqtts/methods.js';\n","Schemas = {};","import { Accounts } from 'meteor/accounts-base';\nimport { Roles } from 'meteor/alanning:roles';\n\nMeteor.startup(() => {\n  if (!Meteor.users.findOne({username: 'admin'})) {\n    var uid = Accounts.createUser({\n        username: 'admin',\n        email: '490842289@qq.com',\n        password: 'public'\n    });\n    Roles.addUsersToRoles(uid, ['admin'], Roles.GLOBAL_GROUP);\n  }\n});\n","// 设置邮件发送信息\nimport { Accounts } from 'meteor/accounts-base';\n\nAccounts.emailTemplates.siteName = \"EnergyMaster\";\nAccounts.emailTemplates.from = '490842289@qq.com';","import './admin.js';\nimport './email.js';\nimport './mqtt-connect.js';\nimport './routers.js';\n\nimport '../../api/devices/server/publications.js';\nimport '../../api/mqtts/server/publications.js';\n","import { Meteor } from 'meteor/meteor';\n\nimport '../../api/mqtts/methods.js';\n\nMeteor.startup(() => {\n    // code to run on server at startup\n    connect.call({topic: Meteor.settings.mqttTopic});\n});","import { Router } from 'meteor/iron:router';\nimport fs from 'fs';\n\n\nRouter.route('/download', function () {\n    const title = \"ADE7953_1.0.0_Luat_V0027_8955.bin\";\n    const headers = {\n      'Content-type': 'application/octet-stream',\n      'Content-Disposition': 'attachment; filename=' + title\n    };\n    const filepath = Assets.absoluteFilePath(title);\n    this.response.writeHead(200, headers);\n    this.response.end(fs.readFileSync(filepath));\n  },{where: 'server'});\n\nRouter.route('/upload/OTA', function () {\n    if (this.request){\n        console.log(this.request);\n    //     const uploadpath = \"/home/wangziguan/wzg/\";\n    //     const filename = uploadpath + \"1.bin\";\n    //     const uploadfile = this.request.files[0]\n    //     fs.writeFile(filename, uploadfile, function(err){\n    //         if (err) throw err ;\n    //         console.log(\"File Saved !\"); \n    //     });\n    };\n    this.response.writeHead(200);\n    this.response.end();\n},{where: 'server'});  \n   ","import '/imports/startup/server';\nimport '/imports/startup/both';\n"]}